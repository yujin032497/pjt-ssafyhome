<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ssafy.pjt.model.mapper.QnaDao">
	
	<resultMap type="qna" id="question">
		<result column="qna_no" property="qnaNo"/>
		<result column="subject" property="subject"/>
		<result column="content" property="content"/>
		<result column="id" property="userId"/>
		<result column="state" property="state"/>
		<result column="answer" property="answer"/>
		<result column="content_a" property="contentA"/>
		<result column="register_time" property="registerTime"/>
	</resultMap>
	<resultMap type="qna" id="qnaAll" extends="question">
		<result column="name" property="userName"/>
	</resultMap>
	<delete id="deleteAll">
		DELETE
		FROM qna
		where id=#{id}
	</delete>
	
	<select id="getTotalQna" resultType="int">
		SELECT COUNT(*)
		FROM qna
	</select>
	

	<select id="getListQna" parameterType="map" resultMap="qnaAll">
		select b.qna_no, b.subject, b.register_time, b.state, b.content_a, b.id
		from qna b, user m 
		where b.id = m.id
		and b.id = #{userId}
		order by b.qna_no desc
	</select>
	
	<select id="getListQnaAll" resultMap="qnaAll">
		select b.qna_no, b.id, b.subject, b.register_time, b.state, b.content_a, b.id
		from qna b, user m 
		where b.id = m.id
		order by b.qna_no desc
	</select>
	
	<insert id="writeQna" parameterType="qna">
		insert into qna (subject, content, id, register_time, state)
		values (#{subject}, #{content}, #{userId}, now(), 1)
		<selectKey resultType="int" keyProperty="qnaNo" order="AFTER">
			select last_insert_id()
		</selectKey>
	</insert>
	
	<select id="getQna" parameterType="int" resultMap="qnaAll">
		select b.qna_no, b.subject, b.content, b.register_time, b.state, b.content_a, b.id
		from qna b, user m
		where b.id = m.id
		and b.qna_no = #{QnaNo}
	</select>
	
	<update id="updateQna" parameterType="qna">
		update qna
		set content_a = #{contentA}, register_time=now(), state = #{state}
		where Qna_no = #{qnaNo}
	</update>
	
	<delete id="deleteQna" parameterType="int">
		delete from qna
		where qna_no = #{qnaNo}
	</delete>
</mapper>